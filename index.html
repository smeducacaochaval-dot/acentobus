<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>AcentoBus</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#1976d2;color:white;text-align:center}
.card{background:white;color:black;margin:15px auto;padding:15px;border-radius:15px;width:360px}
input,button,textarea{width:100%;padding:8px;margin-top:6px}
button{background:#1976d2;color:white;border:none;border-radius:8px}
.hidden{display:none}
small{color:#555}
hr{margin:10px 0}
</style>
</head>
<body>

<div class="card" id="loginUser">
  <h2>AcentoBus</h2>
  <input id="nome" placeholder="Seu nome">
  <input id="codigo" placeholder="Seu código">
  <button onclick="entrarUsuario()">Entrar</button>
  <br><br>
  <button onclick="mostrarAdmin()">Sou Administrador</button>
</div>

<div class="card hidden" id="loginAdmin">
  <h3>Login do Administrador</h3>
  <input id="adminUser" placeholder="Usuário">
  <input id="adminPass" type="password" placeholder="Senha">
  <button onclick="entrarAdmin()">Entrar</button>
  <button onclick="voltar()">Voltar</button>
</div>

<div class="card hidden" id="painelAdmin">
  <h3>Painel do Administrador</h3>

  <h4>Configurar ônibus</h4>
  <div id="configOnibus"></div>
  <button onclick="salvarOnibus()">Salvar ônibus</button>

  <hr>

  <h4>Códigos dos usuários</h4>
  <input id="novoCodigo" placeholder="Novo código">
  <button onclick="adicionarCodigo()">Adicionar código</button>
  <div id="listaCodigos"></div>

  <hr>

  <h4>Reservas</h4>
  <div id="listaReservas"></div>

  <hr>

  <h4>Sugestões e reclamações</h4>
  <div id="listaFeedbacks"></div>

  <hr>

  <h4>Alterar senha</h4>
  <input id="novaSenha" type="password" placeholder="Nova senha">
  <button onclick="trocarSenha()">Salvar nova senha</button>

  <br><br>
  <button onclick="sair()">Sair</button>
</div>

<div class="card hidden" id="painelUser">
  <h3>Minha reserva</h3>
  <div id="statusReserva"></div>

  <hr>

  <h4>Escolher / Trocar ônibus</h4>
  <div id="listaOnibus"></div>

  <button onclick="cancelarReserva()">Cancelar reserva</button>

  <hr>

  <h4>Sugestão / Reclamação</h4>
  <textarea id="mensagem" placeholder="Escreva aqui..."></textarea>
  <button onclick="enviarMensagem()">Enviar</button>

  <br><br>
  <button onclick="sair()">Sair</button>
</div>

<script>
const ADMIN_USER="smechaval";
let ADMIN_PASS=localStorage.getItem("adminPass")||"smech@v@l";

let onibus=JSON.parse(localStorage.getItem("onibus"))||[
 {nome:"Ônibus 1",vagas:40},
 {nome:"Ônibus 2",vagas:40},
 {nome:"Ônibus 3",vagas:40},
 {nome:"Ônibus 4",vagas:40},
 {nome:"Ônibus 5",vagas:40}
];

let codigos=JSON.parse(localStorage.getItem("codigos"))||[];
let reservas=JSON.parse(localStorage.getItem("reservas"))||[];
let feedbacks=JSON.parse(localStorage.getItem("feedbacks"))||[];

let usuarioAtual=null;

function mostrarAdmin(){
 loginUser.classList.add("hidden");
 loginAdmin.classList.remove("hidden");
}

function voltar(){
 loginAdmin.classList.add("hidden");
 loginUser.classList.remove("hidden");
}

function entrarAdmin(){
 if(adminUser.value===ADMIN_USER && adminPass.value===ADMIN_PASS){
  loginAdmin.classList.add("hidden");
  painelAdmin.classList.remove("hidden");
  carregarConfig();
  listarCodigos();
  listarReservas();
  listarFeedbacks();
 } else alert("Usuário ou senha incorretos");
}

function trocarSenha(){
 if(!novaSenha.value){alert("Digite a nova senha");return;}
 ADMIN_PASS=novaSenha.value;
 localStorage.setItem("adminPass",ADMIN_PASS);
 alert("Senha alterada!");
 novaSenha.value="";
}

function carregarConfig(){
 let html="";
 onibus.forEach((o,i)=>{
  html+=`
   <small>Ônibus ${i+1}</small>
   <input value="${o.nome}" onchange="onibus[${i}].nome=this.value">
   <input type="number" value="${o.vagas}" onchange="onibus[${i}].vagas=this.value">
   <br>`;
 });
 configOnibus.innerHTML=html;
}

function salvarOnibus(){
 localStorage.setItem("onibus",JSON.stringify(onibus));
 alert("Ônibus salvos!");
}

function adicionarCodigo(){
 const c=novoCodigo.value.trim();
 if(!c){alert("Digite um código");return;}
 if(codigos.includes(c)){alert("Código já existe");return;}
 codigos.push(c);
 localStorage.setItem("codigos",JSON.stringify(codigos));
 novoCodigo.value="";
 listarCodigos();
}

function listarCodigos(){
 let html="";
 codigos.forEach((c,i)=>{
  html+=`${c} <button onclick="removerCodigo(${i})">❌</button><br>`;
 });
 listaCodigos.innerHTML=html;
}

function removerCodigo(i){
 codigos.splice(i,1);
 localStorage.setItem("codigos",JSON.stringify(codigos));
 listarCodigos();
}

function listarReservas(){
 let html="";
 reservas.forEach(r=>{
  html+=`${r.nome} (${r.codigo}) → ${r.onibus}<br>`;
 });
 listaReservas.innerHTML=html||"Nenhuma reserva";
}

function listarFeedbacks(){
 let html="";
 feedbacks.forEach(f=>{
  html+=`${f.nome||"Anônimo"}: ${f.msg}<br>`;
 });
 listaFeedbacks.innerHTML=html||"Nenhuma mensagem";
}

function entrarUsuario(){
 if(!nome.value||!codigo.value){alert("Preencha os campos");return;}
 if(!codigos.includes(codigo.value)){alert("Código inválido");return;}

 usuarioAtual={nome:nome.value,codigo:codigo.value};

 loginUser.classList.add("hidden");
 painelUser.classList.remove("hidden");

 atualizarStatusReserva();
 listarOnibus();
}

function atualizarStatusReserva(){
 const r=reservas.find(r=>r.codigo===usuarioAtual.codigo);
 if(r){
  statusReserva.innerHTML=`Você reservou no: <b>${r.onibus}</b>`;
 } else {
  statusReserva.innerHTML="Você ainda não tem reserva.";
 }
}

function listarOnibus(){
 let html="";
 onibus.forEach((o,i)=>{
  const usados=reservas.filter(r=>r.onibus===o.nome).length;
  const restantes=o.vagas-usados;
  html+=`<button onclick="reservar(${i})">${o.nome} (${restantes} vagas)</button><br>`;
 });
 listaOnibus.innerHTML=html;
}

function reservar(i){
 const atual=reservas.find(r=>r.codigo===usuarioAtual.codigo);
 if(atual){
  atual.onibus=onibus[i].nome;
 } else {
  reservas.push({nome:usuarioAtual.nome,codigo:usuarioAtual.codigo,onibus:onibus[i].nome});
 }
 localStorage.setItem("reservas",JSON.stringify(reservas));
 alert("Reserva atualizada!");
 atualizarStatusReserva();
 listarOnibus();
}

function cancelarReserva(){
 reservas=reservas.filter(r=>r.codigo!==usuarioAtual.codigo);
 localStorage.setItem("reservas",JSON.stringify(reservas));
 alert("Reserva cancelada!");
 atualizarStatusReserva();
 listarOnibus();
}

function enviarMensagem(){
 if(!mensagem.value){alert("Digite a mensagem");return;}
 feedbacks.push({nome:usuarioAtual.nome,msg:mensagem.value});
 localStorage.setItem("feedbacks",JSON.stringify(feedbacks));
 mensagem.value="";
 alert("Mensagem enviada!");
}

function sair(){location.reload();}
</script>

</body>
</html>


