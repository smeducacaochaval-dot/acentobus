<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>AcentoBus</title>
<link rel="manifest" href="manifest.json">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#0d47a1;color:white;text-align:center}
.header{background:white;color:#0d47a1;padding:10px;border-radius:15px;margin:10px}
.header img{max-width:120px;margin-bottom:5px}
.card{background:white;color:black;margin:15px auto;padding:15px;border-radius:15px;width:360px}
input,button,textarea{width:100%;padding:8px;margin-top:6px}
button{background:#0d47a1;color:white;border:none;border-radius:8px}
.hidden{display:none}
small{color:#555}
hr{margin:10px 0}
</style>
</head>
<body>

<div class="header">
  <img src="logo.png" alt="Logo">
  <h2>AcentoBus</h2>
</div>

<div class="card" id="loginUser">
  <input id="nome" placeholder="Seu nome">
  <input id="codigo" placeholder="Seu c√≥digo">
  <button onclick="entrarUsuario()">Entrar</button>
  <br><br>
  <button onclick="mostrarAdmin()">Sou Administrador</button>
</div>

<div class="card hidden" id="loginAdmin">
  <h3>Login do Administrador</h3>
  <input id="adminUser" placeholder="Usu√°rio">
  <input id="adminPass" type="password" placeholder="Senha">
  <button onclick="entrarAdmin()">Entrar</button>
  <button onclick="voltar()">Voltar</button>
</div>

<div class="card hidden" id="painelAdmin">
  <h3>Painel do Administrador</h3>

  <h4>Configurar √¥nibus</h4>
  <div id="configOnibus"></div>
  <button onclick="salvarOnibus()">Salvar √¥nibus</button>

  <hr>

  <h4>C√≥digos dos usu√°rios</h4>
  <input id="novoCodigo" placeholder="Novo c√≥digo">
  <button onclick="adicionarCodigo()">Adicionar c√≥digo</button>
  <div id="listaCodigos"></div>

  <hr>

  <h4>Reservas</h4>
  <div id="listaReservas"></div>
  <button onclick="limparReservas()">üßπ Limpar reservas do dia</button>

  <hr>

  <h4>Alterar senha</h4>
  <input id="novaSenha" type="password" placeholder="Nova senha">
  <button onclick="trocarSenha()">Salvar nova senha</button>

  <br><br>
  <button onclick="sair()">Sair</button>
</div>

<div class="card hidden" id="painelUser">
  <h3>Minha reserva</h3>
  <div id="statusReserva"></div>

  <hr>

  <h4>Escolher / Trocar √¥nibus</h4>
  <div id="listaOnibus"></div>

  <button onclick="cancelarReserva()">Cancelar reserva</button>

  <br><br>
  <button onclick="sair()">Sair</button>
</div>

<script>
const ADMIN_USER="smechaval";
let ADMIN_PASS=localStorage.getItem("adminPass")||"smech@v@l";

let onibus=JSON.parse(localStorage.getItem("onibus"))||[
 {nome:"√înibus 1",vagas:40},
 {nome:"√înibus 2",vagas:40},
 {nome:"√înibus 3",vagas:40},
 {nome:"√înibus 4",vagas:40},
 {nome:"√înibus 5",vagas:40}
];

let codigos=JSON.parse(localStorage.getItem("codigos"))||[];
let reservas=JSON.parse(localStorage.getItem("reservas"))||[];

let usuarioAtual=null;

function dentroDoHorario(){
 const agora=new Date();
 const h=agora.getHours();
 return h>=8 && h<17;
}

function mostrarAdmin(){
 loginUser.classList.add("hidden");
 loginAdmin.classList.remove("hidden");
}

function voltar(){
 loginAdmin.classList.add("hidden");
 loginUser.classList.remove("hidden");
}

function entrarAdmin(){
 if(adminUser.value===ADMIN_USER && adminPass.value===ADMIN_PASS){
  loginAdmin.classList.add("hidden");
  painelAdmin.classList.remove("hidden");
  carregarConfig();
  listarCodigos();
  listarReservas();
 } else alert("Usu√°rio ou senha incorretos");
}

function trocarSenha(){
 if(!novaSenha.value){alert("Digite a nova senha");return;}
 ADMIN_PASS=novaSenha.value;
 localStorage.setItem("adminPass",ADMIN_PASS);
 alert("Senha alterada!");
 novaSenha.value="";
}

function carregarConfig(){
 let html="";
 onibus.forEach((o,i)=>{
  html+=`
   <small>√înibus ${i+1}</small>
   <input value="${o.nome}" onchange="onibus[${i}].nome=this.value">
   <input type="number" value="${o.vagas}" onchange="onibus[${i}].vagas=this.value">
   <br>`;
 });
 configOnibus.innerHTML=html;
}

function salvarOnibus(){
 localStorage.setItem("onibus",JSON.stringify(onibus));
 alert("√înibus salvos!");
}

function adicionarCodigo(){
 const c=novoCodigo.value.trim();
 if(!c){alert("Digite um c√≥digo");return;}
 if(codigos.includes(c)){alert("C√≥digo j√° existe");return;}
 codigos.push(c);
 localStorage.setItem("codigos",JSON.stringify(codigos));
 novoCodigo.value="";
 listarCodigos();
}

function listarCodigos(){
 let html="";
 codigos.forEach((c,i)=>{
  html+=`${c} <button onclick="removerCodigo(${i})">‚ùå</button><br>`;
 });
 listaCodigos.innerHTML=html;
}

function removerCodigo(i){
 codigos.splice(i,1);
 localStorage.setItem("codigos",JSON.stringify(codigos));
 listarCodigos();
}

function listarReservas(){
 let html="";
 reservas.forEach(r=>{
  html+=`${r.nome} (${r.codigo}) ‚Üí ${r.onibus}<br>`;
 });
 listaReservas.innerHTML=html||"Nenhuma reserva";
}

function limparReservas(){
 if(confirm("Apagar todas as reservas do dia?")){
  reservas=[];
  localStorage.setItem("reservas",JSON.stringify(reservas));
  listarReservas();
  alert("Reservas apagadas!");
 }
}

function entrarUsuario(){
 if(!dentroDoHorario()){
  alert("Reservas permitidas somente das 08:00 √†s 17:00");
  return;
 }

 if(!nome.value||!codigo.value){alert("Preencha os campos");return;}
 if(!codigos.includes(codigo.value)){alert("C√≥digo inv√°lido");return;}

 usuarioAtual={nome:nome.value,codigo:codigo.value};

 loginUser.classList.add("hidden");
 painelUser.classList.remove("hidden");

 atualizarStatusReserva();
 listarOnibus();
}

function atualizarStatusReserva(){
 const r=reservas.find(r=>r.codigo===usuarioAtual.codigo);
 if(r){
  statusReserva.innerHTML=`Voc√™ reservou no: <b>${r.onibus}</b>`;
 } else {
  statusReserva.innerHTML="Voc√™ ainda n√£o tem reserva.";
 }
}

function listarOnibus(){
 let html="";
 onibus.forEach((o,i)=>{
  const usados=reservas.filter(r=>r.onibus===o.nome).length;
  const restantes=o.vagas-usados;
  html+=`<button onclick="reservar(${i})">${o.nome} (${restantes} vagas)</button><br>`;
 });
 listaOnibus.innerHTML=html;
}

function reservar(i){
 const atual=reservas.find(r=>r.codigo===usuarioAtual.codigo);
 if(atual){
  atual.onibus=onibus[i].nome;
 } else {
  reservas.push({nome:usuarioAtual.nome,codigo:usuarioAtual.codigo,onibus:onibus[i].nome});
 }
 localStorage.setItem("reservas",JSON.stringify(reservas));
 alert("Reserva atualizada!");
 atualizarStatusReserva();
 listarOnibus();
}

function cancelarReserva(){
 reservas=reservas.filter(r=>r.codigo!==usuarioAtual.codigo);
 localStorage.setItem("reservas",JSON.stringify(reservas));
 alert("Reserva cancelada!");
 atualizarStatusReserva();
 listarOnibus();
}

function sair(){location.reload();}
</script>

</body>
</html>


