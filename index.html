<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>AcentoBus</title>
<link rel="manifest" href="manifest.json">
<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; text-align:center; }
button { padding:10px; margin:5px; }
.box { background:white; padding:15px; margin:10px; border-radius:8px; }
.hidden { display:none; }
textarea { width:90%; height:80px; }
</style>
</head>
<body>

<h1>AcentoBus</h1>

<!-- LOGIN -->
<div class="box" id="loginUsuario">
  <h3>Reserva</h3>
  <input id="nome" placeholder="Nome"><br><br>
  <input id="codigo" placeholder="Código"><br><br>
  <button onclick="mostrarOnibus()">Entrar</button><br><br>
  <button onclick="abrirSugestoes()">Sugestões / Reclamações</button>
</div>

<!-- TELA ÔNIBUS -->
<div class="box hidden" id="telaOnibus"></div>

<!-- TELA LISTA -->
<div class="box hidden" id="telaLista"></div>

<!-- TELA SUGESTÕES -->
<div class="box hidden" id="telaSugestao">
  <h3>Sugestões / Reclamações</h3>
  <textarea id="sugestao" placeholder="Digite aqui"></textarea><br><br>
  <button onclick="enviarSugestao()">Enviar</button><br><br>
  <button onclick="voltarInicio()">Retornar</button>
</div>

<script>
const onibusPadrao = {
  1:{nome:"Ônibus 1", vagas:5, lista:[]},
  2:{nome:"Ônibus 2", vagas:5, lista:[]},
  3:{nome:"Ônibus 3", vagas:5, lista:[]},
  4:{nome:"Ônibus 4", vagas:5, lista:[]},
  5:{nome:"Ônibus 5", vagas:5, lista:[]}
};

function verificarNovoDia(){
  const hoje = new Date().toLocaleDateString();
  const salvo = localStorage.getItem("dataSistema");
  if(salvo !== hoje){
    localStorage.setItem("onibus", JSON.stringify(onibusPadrao));
    localStorage.removeItem("reservas");
    localStorage.removeItem("sugestoes");
    localStorage.setItem("dataSistema", hoje);
  }
}

verificarNovoDia();

let onibus = JSON.parse(localStorage.getItem("onibus")) || onibusPadrao;
let reservas = JSON.parse(localStorage.getItem("reservas")) || {};

function esconderTudo(){
  document.getElementById("loginUsuario").classList.add("hidden");
  document.getElementById("telaOnibus").classList.add("hidden");
  document.getElementById("telaLista").classList.add("hidden");
  document.getElementById("telaSugestao").classList.add("hidden");
}

function mostrarOnibus(){
  esconderTudo();
  const tela = document.getElementById("telaOnibus");
  tela.classList.remove("hidden");
  tela.innerHTML="<h3>Escolha seu ônibus</h3>";

  for(let i in onibus){
    let btn=document.createElement("button");
    btn.innerText=`${onibus[i].nome} - ${onibus[i].vagas} vagas`;
    btn.onclick=()=>reservar(i);
    tela.appendChild(btn);
  }

  let voltar=document.createElement("button");
  voltar.innerText="Retornar";
  voltar.onclick=voltarInicio;
  tela.appendChild(document.createElement("br"));
  tela.appendChild(voltar);
}

function reservar(id){
  const nome=document.getElementById("nome").value;
  const codigo=document.getElementById("codigo").value;

  if(!nome||!codigo){alert("Preencha tudo");return;}

  if(reservas[codigo]){
    let antigo=reservas[codigo].onibus;
    onibus[antigo].vagas++;
    onibus[antigo].lista = onibus[antigo].lista.filter(n=>n!==reservas[codigo].nome);
  }

  if(onibus[id].vagas<=0){alert("Sem vagas");return;}

  reservas[codigo]={nome:nome,onibus:id};
  onibus[id].vagas--;
  onibus[id].lista.push(nome);

  localStorage.setItem("reservas",JSON.stringify(reservas));
  localStorage.setItem("onibus",JSON.stringify(onibus));

  mostrarLista(id);
}

function mostrarLista(id){
  esconderTudo();
  const tela=document.getElementById("telaLista");
  tela.classList.remove("hidden");
  tela.innerHTML=`<h3>${onibus[id].nome}</h3>`;

  onibus[id].lista.forEach(n=>{
    let p=document.createElement("p");
    p.innerText=n;
    tela.appendChild(p);
  });

  let voltar=document.createElement("button");
  voltar.innerText="Retornar";
  voltar.onclick=voltarInicio;
  tela.appendChild(voltar);
}

function abrirSugestoes(){
  esconderTudo();
  document.getElementById("telaSugestao").classList.remove("hidden");
}

function voltarInicio(){
  esconderTudo();
  document.getElementById("loginUsuario").classList.remove("hidden");
}

function enviarSugestao(){
  let texto=document.getElementById("sugestao").value;
  if(!texto)return;
  let s=JSON.parse(localStorage.getItem("sugestoes"))||[];
  s.push({msg:texto,data:new Date().toLocaleDateString()});
  localStorage.setItem("sugestoes",JSON.stringify(s));
  alert("Enviado!");
  document.getElementById("sugestao").value="";
}
</script>
</body>
</html>
